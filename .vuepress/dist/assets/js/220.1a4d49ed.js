(window.webpackJsonp=window.webpackJsonp||[]).push([[220],{387:function(e,t,s){"use strict";s.r(t);var a=s(0),r=Object(a.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._v(" "),s("p",[e._v("graceful-fs functions as a drop-in replacement for the fs module,\nmaking various improvements.")]),e._v(" "),s("p",[e._v("The improvements are meant to normalize behavior across different\nplatforms and environments, and to make filesystem access more\nresilient to errors.")]),e._v(" "),s("h2",{attrs:{id:"improvements-over-fs-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#improvements-over-fs-module","aria-hidden":"true"}},[e._v("#")]),e._v(" Improvements over "),s("a",{attrs:{href:"https://nodejs.org/api/fs.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("fs module"),s("OutboundLink")],1)]),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._m(5),e._v(" "),s("p",[e._v("If you want to patch the global fs module (or any other fs-like\nmodule) you can do this:")]),e._v(" "),e._m(6),e._m(7),e._v(" "),e._m(8),e._v(" "),s("p",[e._v("This module is fairly stable at this point, and used by a lot of\nthings.  That being said, because it implements a subtle behavior\nchange in a core part of the node API, even modest changes can be\nextremely breaking, and the versioning is thus biased towards\nbumping the major when in doubt.")]),e._v(" "),e._m(9),e._v(" "),e._m(10),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),e._m(13),e._v(" "),e._m(14),e._v(" "),e._m(15),e._v(" "),e._m(16),e._v(" "),e._m(17),e._v(" "),e._m(18),e._v(" "),e._m(19),e._v(" "),e._m(20),e._v(" "),e._m(21),e._v(" "),e._m(22),e._v(" "),e._m(23),e._v(" "),e._m(24),e._v(" "),e._m(25)])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"graceful-fs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#graceful-fs","aria-hidden":"true"}},[this._v("#")]),this._v(" graceful-fs")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[e._v("Queues up "),s("code",[e._v("open")]),e._v(" and "),s("code",[e._v("readdir")]),e._v(" calls, and retries them once\nsomething closes if there is an EMFILE error from too many file\ndescriptors.")]),e._v(" "),s("li",[e._v("fixes "),s("code",[e._v("lchmod")]),e._v(" for Node versions prior to 0.6.2.")]),e._v(" "),s("li",[e._v("implements "),s("code",[e._v("fs.lutimes")]),e._v(" if possible. Otherwise it becomes a noop.")]),e._v(" "),s("li",[e._v("ignores "),s("code",[e._v("EINVAL")]),e._v(" and "),s("code",[e._v("EPERM")]),e._v(" errors in "),s("code",[e._v("chown")]),e._v(", "),s("code",[e._v("fchown")]),e._v(" or\n"),s("code",[e._v("lchown")]),e._v(" if the user isn't root.")]),e._v(" "),s("li",[e._v("makes "),s("code",[e._v("lchmod")]),e._v(" and "),s("code",[e._v("lchown")]),e._v(" become noops, if not available.")]),e._v(" "),s("li",[e._v("retries reading a file if "),s("code",[e._v("read")]),e._v(" results in EAGAIN error.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("On Windows, it retries renaming a file for up to one second if "),t("code",[this._v("EACCESS")]),this._v("\nor "),t("code",[this._v("EPERM")]),this._v(" error occurs, likely because antivirus software has locked\nthe directory.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"usage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usage","aria-hidden":"true"}},[this._v("#")]),this._v(" USAGE")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// use just like fs")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" fs "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'graceful-fs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// now go and do stuff with it...")]),e._v("\nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("readFileSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'some-file-or-whatever'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"global-patching"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#global-patching","aria-hidden":"true"}},[this._v("#")]),this._v(" Global Patching")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Make sure to read the caveat below.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" realFs "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'fs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" gracefulFs "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'graceful-fs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\ngracefulFs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("gracefulify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("realFs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("This should only ever be done at the top-level application layer, in\norder to delay on EMFILE errors from any fs-using dependencies.  You\nshould "),t("strong",[this._v("not")]),this._v(" do this in a library, because it can cause unexpected\ndelays in other parts of the program.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"changes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changes","aria-hidden":"true"}},[this._v("#")]),this._v(" Changes")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The main change between major versions has been switching between\nproviding a fully-patched "),t("code",[this._v("fs")]),this._v(" module vs monkey-patching the node core\nbuiltin, and the approach by which a non-monkey-patched "),t("code",[this._v("fs")]),this._v(" was\ncreated.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The goal is to trade "),t("code",[this._v("EMFILE")]),this._v(" errors for slower fs operations.  So, if\nyou try to open a zillion files, rather than crashing, "),t("code",[this._v("open")]),this._v("\noperations will be queued up and wait for something else to "),t("code",[this._v("close")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("There are advantages to each approach.  Monkey-patching the fs means\nthat no "),t("code",[this._v("EMFILE")]),this._v(" errors can possibly occur anywhere in your\napplication, because everything is using the same core "),t("code",[this._v("fs")]),this._v(" module,\nwhich is patched.  However, it can also obviously cause undesirable\nside-effects, especially if the module is loaded multiple times.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Implementing a separate-but-identical patched "),t("code",[this._v("fs")]),this._v(" module is more\nsurgical (and doesn't run the risk of patching multiple times), but\nalso imposes the challenge of keeping in sync with the core module.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The current approach loads the "),t("code",[this._v("fs")]),this._v(" module, and then creates a\nlookalike object that has all the same methods, except a few that are\npatched.  It is safe to use in all versions of Node from 0.8 through\n7.0.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"v4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v4","aria-hidden":"true"}},[this._v("#")]),this._v(" v4")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Do not monkey-patch the fs module.  This module may now be used as a\ndrop-in dep, and users can opt into monkey-patching the fs builtin\nif their app requires it.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"v3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v3","aria-hidden":"true"}},[this._v("#")]),this._v(" v3")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[e._v("Monkey-patch fs, because the eval approach no longer works on recent\nnode.")]),e._v(" "),s("li",[e._v("fixed possible type-error throw if rename fails on windows")]),e._v(" "),s("li",[e._v("verify that we "),s("em",[e._v("never")]),e._v(" get EMFILE errors")]),e._v(" "),s("li",[e._v("Ignore ENOSYS from chmod/chown")]),e._v(" "),s("li",[e._v("clarify that graceful-fs must be used as a drop-in")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"v2-1-0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v2-1-0","aria-hidden":"true"}},[this._v("#")]),this._v(" v2.1.0")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Use eval rather than monkey-patching fs.")]),this._v(" "),t("li",[this._v("readdir: Always sort the results")]),this._v(" "),t("li",[this._v("win32: requeue a file if error has an OK status")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"v2-0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v2-0","aria-hidden":"true"}},[this._v("#")]),this._v(" v2.0")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("A return to monkey patching")]),this._v(" "),t("li",[this._v("wrap process.cwd")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"v1-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v1-1","aria-hidden":"true"}},[this._v("#")]),this._v(" v1.1")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[e._v("wrap readFile")]),e._v(" "),s("li",[e._v("Wrap fs.writeFile.")]),e._v(" "),s("li",[e._v("readdir protection")]),e._v(" "),s("li",[e._v("Don't clobber the fs builtin")]),e._v(" "),s("li",[e._v("Handle fs.read EAGAIN errors by trying again")]),e._v(" "),s("li",[e._v("Expose the curOpen counter")]),e._v(" "),s("li",[e._v("No-op lchown/lchmod if not implemented")]),e._v(" "),s("li",[e._v("fs.rename patch only for win32")]),e._v(" "),s("li",[e._v("Patch fs.rename to handle AV software on Windows")]),e._v(" "),s("li",[e._v("Close #4 Chown should not fail on einval or eperm if non-root")]),e._v(" "),s("li",[e._v("Fix isaacs/fstream#1 Only wrap fs one time")]),e._v(" "),s("li",[e._v("Fix #3 Start at 1024 max files, then back off on EMFILE")]),e._v(" "),s("li",[e._v("lutimes that doens't blow up on Linux")]),e._v(" "),s("li",[e._v("A full on-rewrite using a queue instead of just swallowing the EMFILE error")]),e._v(" "),s("li",[e._v("Wrap Read/Write streams as well")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"_1-0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-0","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.0")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Update engines for node 0.6")]),this._v(" "),t("li",[this._v("Be lstat-graceful on Windows")]),this._v(" "),t("li",[this._v("first")])])}],!1,null,null,null);t.default=r.exports}}]);